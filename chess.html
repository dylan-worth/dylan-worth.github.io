<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aesthetic Glass Chess - Full Board</title>
    <style>
        body { margin: 0; background: #020205; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #ui {
            position: absolute; top: 30px; width: 100%; text-align: center;
            color: rgba(255,255,255,0.4); letter-spacing: 4px; text-transform: uppercase;
            pointer-events: none; font-size: 12px;
        }
        canvas { display: block; }
    </style>
</head>
<body>
    <div id="ui">Liquid Refraction // Complete Set</div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';

        // --- Scene & Renderer ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        document.body.appendChild(renderer.domElement);

        // --- Environment Lighting ---
        const genEnv = () => {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createRadialGradient(256, 256, 0, 256, 256, 256);
            grad.addColorStop(0, '#223344');
            grad.addColorStop(1, '#000000');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 512, 512);
            const tex = new THREE.CanvasTexture(canvas);
            tex.mapping = THREE.EquirectangularReflectionMapping;
            return tex;
        };
        scene.environment = genEnv();

        // --- Materials ---
        const createLiquidMat = (color, thickColor) => new THREE.MeshPhysicalMaterial({
            transmission: 1.0, thickness: 1.5, roughness: 0.02, ior: 1.33,
            color: color, attenuationColor: thickColor, attenuationDistance: 0.5,
            clearcoat: 1.0, specularIntensity: 1.0
        });

        const lightMat = createLiquidMat(0xffffff, 0x00ffff); // Cyan Water
        const darkMat = createLiquidMat(0x333333, 0xff0066);  // Ink/Magenta
        
        const boardMat = new THREE.MeshPhysicalMaterial({
            transmission: 0.9, roughness: 0.1, thickness: 1, color: 0xffffff,
            attenuationColor: 0x222244, attenuationDistance: 1
        });

        // --- Board & Grid ---
        const board = new THREE.Mesh(new THREE.BoxGeometry(8.5, 0.4, 8.5), boardMat);
        board.position.y = -0.22;
        scene.add(board);

        const grid = new THREE.GridHelper(8, 8, 0xffffff, 0x333333);
        grid.position.y = -0.01;
        scene.add(grid);

        // --- Geometry Factory ---
        const geometries = {
            pawn: new THREE.SphereGeometry(0.3, 32, 32),
            rook: new THREE.CylinderGeometry(0.35, 0.35, 0.8, 32),
            knight: new THREE.TorusKnotGeometry(0.2, 0.08, 64, 8, 2, 3), // Stylized "Splash"
            bishop: new THREE.ConeGeometry(0.3, 1, 32),
            queen: new THREE.IcosahedronGeometry(0.45, 2),
            king: new THREE.CylinderGeometry(0.2, 0.4, 1.3, 4) // Diamond pillar
        };

        const spawnPiece = (type, x, z, mat) => {
            const piece = new THREE.Mesh(geometries[type], mat);
            piece.position.set(x - 3.5, 0.5, z - 3.5);
            // Offset logic for visual height
            if(type === 'king' || type === 'queen') piece.position.y = 0.65;
            scene.add(piece);
            return piece;
        };

        // --- Populate Full Board ---
        const layout = ['rook', 'knight', 'bishop', 'queen', 'king', 'bishop', 'knight', 'rook'];
        
        for (let i = 0; i < 8; i++) {
            // Light Side
            spawnPiece(layout[i], i, 0, lightMat);
            spawnPiece('pawn', i, 1, lightMat);
            
            // Dark Side
            spawnPiece(layout[i], i, 7, darkMat);
            spawnPiece('pawn', i, 6, darkMat);
        }

        // --- Lights ---
        const p1 = new THREE.PointLight(0x00ffff, 20); p1.position.set(4, 4, 4); scene.add(p1);
        const p2 = new THREE.PointLight(0xff00ff, 20); p2.position.set(-4, 4, -4); scene.add(p2);

        // --- Interaction ---
        camera.position.set(0, 10, 10);
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        function animate(t) {
            requestAnimationFrame(animate);
            // Subtle "breathing" effect for the liquid
            scene.children.forEach(c => {
                if (c.material === lightMat || c.material === darkMat) {
                    c.scale.setScalar(1 + Math.sin(t * 0.001 + c.position.x) * 0.03);
                    c.position.y += Math.sin(t * 0.002 + c.position.z) * 0.001;
                }
            });
            controls.update();
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
