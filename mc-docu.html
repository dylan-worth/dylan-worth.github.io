<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Clone v8.0 - Developer Wiki</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f0f8ff; }
        h1 { border-bottom: 2px solid #0077ff; padding-bottom: 10px; color: #004488; }
        h2 { margin-top: 40px; color: #0066cc; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        h3 { color: #444; border-left: 4px solid #0066cc; padding-left: 10px; margin-top: 25px; }
        code { background: #e6f2ff; padding: 2px 5px; border-radius: 4px; font-family: 'Consolas', monospace; color: #d63384; }
        pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; }
        .note { background: #fff3cd; border-left: 5px solid #ffc107; padding: 15px; margin: 20px 0; }
        .danger { background: #ffe6e6; border-left: 5px solid #cc0000; padding: 15px; margin: 20px 0; }
        .tag { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold; color: white; }
        .tag.core { background: #dc3545; }
        .tag.logic { background: #0d6efd; }
        .tag.new { background: #00cccc; } /* New v8.0 tag */
        
        .nav { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap;}
        .nav a { text-decoration: none; color: #333; font-weight: bold; border-bottom: 2px solid transparent; }
        .nav a:hover { color: #0066cc; border-color: #0066cc; }
    </style>
</head>
<body>

    <h1>‚õèÔ∏è Minecraft Clone v8.0 (Hydro Update) Docs</h1>
    
    <div class="nav">
        <a href="#getting-started">üöÄ Start Here</a>
        <a href="#architecture">üèóÔ∏è Architecture</a>
        <a href="#hydro-logic">üåä Hydro Systems (New)</a>
        <a href="#functions">üìö Function Reference</a>
        <a href="#physics">‚öõÔ∏è Physics Engine</a>
    </div>

    <div id="getting-started">
        <h2>üöÄ Getting Started</h2>
        <p>This project is a <strong>single-file</strong> HTML5 game engine. v8.0 introduces complex water mechanics, larger terrain generation, and hazardous whirlpools.</p>
        
        <h3>Quick Run Guide</h3>
        <ul>
            <li><strong>PC:</strong> Right-click <code>index.html</code> > Open with Chrome.</li>
            <li><strong>Mobile:</strong> Requires a local server (e.g., VS Code Live Server) or hosting on GitHub Pages.</li>
            <li><strong>Orientation:</strong> Strictly requires Landscape mode.</li>
        </ul>
    </div>

    <div id="hydro-logic">
        <h2>üåä Hydro Systems (New in v8.0)</h2>
        <p>The "Hydro Update" adds three major systems to the engine.</p>

        <h3>1. River Generation Algorithm <span class="tag new">New</span></h3>
        <p>Instead of just using hills, we now subtract terrain to create rivers.</p>
        <pre>
// Inside generateWorld() loop:
// 1. Calculate Base Height (Hills)
let h = Math.sin(x/7) + Math.cos(z/9);

// 2. Calculate River Noise (Long, winding channels)
let riverNoise = Math.sin(x/12) + Math.cos(z/15); 

// 3. Cut the River
// If riverNoise is close to 0, we are in a "channel"
if (Math.abs(riverNoise) < 0.2) {
    h = WATER_LEVEL - 2; // Flatten the land below water level
}</pre>

        <h3>2. Whirlpool Physics <span class="tag new">New</span></h3>
        <p>Whirlpools are invisible objects spawned randomly in the ocean. The physics engine checks your distance to them every frame.</p>
        <ul>
            <li><strong>Detection:</strong> Uses Euclidean distance (<code>Math.sqrt(dx*dx + dz*dz)</code>).</li>
            <li><strong>Suction:</strong> If distance < 4 blocks, the player is "caught".</li>
            <li><strong>Effect:</strong>
                <ul>
                    <li><code>velocity.y -= 0.005</code> (Pulls you down)</li>
                    <li><code>player.rotation.y += 0.05</code> (Spins the camera)</li>
                    <li><code>player.position.x -= dx * 0.02</code> (Drags you to center)</li>
                </ul>
            </li>
        </ul>

        <h3>3. Water Buoyancy</h3>
        <p>We check if the player's head or feet are inside a block with <code>type === 'water'</code>.</p>
        <ul>
            <li><strong>Gravity:</strong> Reduced to <code>0.002</code> (simulates floating).</li>
            <li><strong>Drag:</strong> Velocity is multiplied by <code>0.9</code> every frame (simulates water resistance).</li>
        </ul>
    </div>

    <div id="functions">
        <h2>üìö Core Functions Wiki</h2>

        <h3><code>init()</code> <span class="tag core">Core</span></h3>
        <p>Sets up Three.js, Lights, Procedural Sky, and calls <code>generateWorld()</code>. In v8.0, it also initializes the audio context triggers.</p>

        <h3><code>generateWorld()</code> <span class="tag logic">Updated</span></h3>
        <p>Loops through X/Z coordinates from <code>-WORLD_RADIUS</code> to <code>WORLD_RADIUS</code>.</p>
        <ul>
            <li><strong>Step 1:</strong> Calculate terrain height.</li>
            <li><strong>Step 2:</strong> Apply River Noise logic.</li>
            <li><strong>Step 3:</strong> Fill solid blocks (Stone -> Dirt -> Grass/Sand).</li>
            <li><strong>Step 4:</strong> Fill Water blocks (from Terrain Height up to <code>WATER_LEVEL</code>).</li>
            <li><strong>Step 5:</strong> Plant Trees (only if on Grass and NOT in a river).</li>
        </ul>

        <h3><code>updatePhysics()</code> <span class="tag logic">Updated</span></h3>
        <p>The main game loop logic.</p>
        <ul>
            <li><strong>Whirlpool Check:</strong> Prioritized first. If caught, override standard movement.</li>
            <li><strong>Water Check:</strong> If in water, apply buoyancy and drag. If on land, apply normal gravity.</li>
            <li><strong>Collision:</strong> Checks <code>blockMap</code>. If a coordinate is solid, movement stops.</li>
        </ul>

        <h3><code>checkWater(x, y, z)</code> <span class="tag new">New</span></h3>
        <p>Helper function that returns <code>true</code> if the block at the given coordinates is water. Used for swimming logic.</p>
    </div>

    <div id="architecture">
        <h2>üèóÔ∏è Data Structures</h2>
        
        <h3>The Block Map</h3>
        <p>We use a JavaScript <code>Map</code> for O(1) collision lookups.</p>
        <pre>
// Key: "x,y,z" (String)
// Value: THREE.Mesh
blockMap.set("5,10,-3", meshObject);</pre>

        <h3>Whirlpool Object</h3>
        <p>Stored in the global <code>whirlpools</code> array.</p>
        <pre>
{
    x: 12.5,       // World X position
    z: -8.2,       // World Z position
    strength: 0.1  // Pull force (reserved for future use)
}</pre>
    </div>

</body>
</html>
