<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Forest Navigation</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', sans-serif; user-select: none; }
        canvas { display: block; width: 100vw; height: 100vh; touch-action: none; }

        /* --- UI OVERLAY --- */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Top Header */
        #header {
            padding: 20px;
            text-align: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);
        }
        h1 { margin: 0; font-size: 24px; letter-spacing: 2px; }
        p { margin: 5px 0 0 0; font-size: 14px; opacity: 0.8; }

        /* Interaction Popup (Hidden by default) */
        #interaction-modal {
            position: absolute;
            top: 30%; left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(20, 20, 20, 0.95);
            border: 2px solid #e6c86e;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            color: #e6c86e;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none; /* Click-through when hidden */
        }
        #interaction-modal.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }
        .btn-visit {
            display: block;
            margin-top: 15px;
            background: #e6c86e;
            color: #000;
            padding: 10px 20px;
            text-decoration: none;
            font-weight: bold;
            border-radius: 5px;
        }

        /* --- ANALOG STICK --- */
        #joystick-zone {
            position: absolute;
            bottom: 40px;
            left: 40px;
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            pointer-events: auto;
            touch-action: none; /* Prevent scroll on mobile */
        }

        #stick {
            position: absolute;
            top: 50%; left: 50%;
            width: 50px;
            height: 50px;
            background: rgba(230, 200, 110, 0.8);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: transform 0.1s; /* Smooth return to center */
        }

        /* Instructions */
        #hint {
            position: absolute;
            bottom: 40px;
            right: 40px;
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            max-width: 150px;
            text-align: right;
        }

    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>
</head>
<body>

    <div id="ui-layer">
        <div id="header">
            <h1>PORTFOLIO WOODS</h1>
            <p>Use the stick to explore sections</p>
        </div>

        <div id="interaction-modal">
            <h2 id="modal-title">SECTION NAME</h2>
            <p id="modal-desc">Description goes here.</p>
            <a href="#" id="modal-link" class="btn-visit">ENTER</a>
        </div>

        <div id="joystick-zone">
            <div id="stick"></div>
        </div>

        <div id="hint">
            Explore the forest.<br>Find the campfires.
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- CONFIGURATION ---
        // Define your website sections here
        const POIS = [
            { label: "ABOUT ME", desc: "The story behind the creator.", color: 0x3498db, x: 0, z: -15, link: "/about" },
            { label: "PROJECTS", desc: "A showcase of recent work.", color: 0xe74c3c, x: -15, z: 8, link: "/projects" },
            { label: "CONTACT", desc: "Let's build something.", color: 0x9b59b6, x: 15, z: 8, link: "/contact" }
        ];

        // --- SETUP SCENE ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e); // Deep night blue
        scene.fog = new THREE.Fog(0x1a1a2e, 10, 40);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- LIGHTING ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.1); // Very dark ambient
        scene.add(ambientLight);

        // Moonlight
        const moonLight = new THREE.DirectionalLight(0xaaccff, 0.5);
        moonLight.position.set(20, 50, -20);
        moonLight.castShadow = true;
        scene.add(moonLight);

        // Player Light (Lantern)
        const playerLight = new THREE.PointLight(0xffaa00, 2, 15);
        scene.add(playerLight);

        // --- OBJECTS ---
        
        // Ground
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(100, 100),
            new THREE.MeshStandardMaterial({ color: 0x1b3b22, roughness: 0.8 })
        );
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // Player
        const player = new THREE.Mesh(
            new THREE.CapsuleGeometry(0.4, 0.8, 4, 8),
            new THREE.MeshStandardMaterial({ color: 0xffaa00 })
        );
        player.position.set(0, 0.6, 5); // Start away from center
        player.castShadow = true;
        scene.add(player);

        // Generate Forest
        const trees = [];
        function createTree(x, z) {
            const group = new THREE.Group();
            
            // Trunk
            const trunk = new THREE.Mesh(
                new THREE.CylinderGeometry(0.1, 0.3, 1.5, 5),
                new THREE.MeshStandardMaterial({ color: 0x3e2723 })
            );
            trunk.position.y = 0.75;
            trunk.castShadow = true;
            group.add(trunk);

            // Leaves (Darker for night vibe)
            const leaves = new THREE.Mesh(
                new THREE.ConeGeometry(1, 2, 5),
                new THREE.MeshStandardMaterial({ color: 0x145a32 })
            );
            leaves.position.y = 2;
            leaves.castShadow = true;
            group.add(leaves);

            group.position.set(x, 0, z);
            scene.add(group);
            trees.push(group);
        }

        // Fill forest (randomly, avoiding paths roughly)
        for(let i=0; i<60; i++) {
            let x = (Math.random() - 0.5) * 80;
            let z = (Math.random() - 0.5) * 80;
            // Simple distance check to keep center clear
            if(Math.sqrt(x*x + z*z) > 5) createTree(x, z);
        }

        // --- SIGNPOSTS / POIS ---
        const poiObjects = [];
        
        POIS.forEach(data => {
            const group = new THREE.Group();
            group.position.set(data.x, 0, data.z);

            // Post
            const post = new THREE.Mesh(
                new THREE.BoxGeometry(0.2, 2, 0.2),
                new THREE.MeshStandardMaterial({ color: 0x5d4037 })
            );
            post.position.y = 1;
            group.add(post);

            // Signboard
            const board = new THREE.Mesh(
                new THREE.BoxGeometry(1.5, 0.8, 0.1),
                new THREE.MeshStandardMaterial({ color: data.color }) // Section color
            );
            board.position.set(0, 1.8, 0.1);
            group.add(board);

            // Light Beacon (so you can see it from far away)
            const beacon = new THREE.PointLight(data.color, 1, 8);
            beacon.position.y = 2;
            group.add(beacon);

            group.userData = data; // Store info
            scene.add(group);
            poiObjects.push(group);
        });


        // --- ANALOG STICK LOGIC ---
        const stick = { x: 0, y: 0, active: false };
        const zone = document.getElementById('joystick-zone');
        const stickEl = document.getElementById('stick');
        const maxDist = 35; // Max drag distance in pixels

        function handleInput(clientX, clientY, isEnd = false) {
            if (isEnd) {
                stick.x = 0; 
                stick.y = 0; 
                stick.active = false;
                stickEl.style.transform = `translate(-50%, -50%)`;
                stickEl.style.transition = 'transform 0.1s';
                return;
            }

            stick.active = true;
            stickEl.style.transition = 'none';

            const rect = zone.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            let dx = clientX - centerX;
            let dy = clientY - centerY;

            // Clamp distance
            const dist = Math.sqrt(dx*dx + dy*dy);
            if (dist > maxDist) {
                const angle = Math.atan2(dy, dx);
                dx = Math.cos(angle) * maxDist;
                dy = Math.sin(angle) * maxDist;
            }

            // Move stick visual
            stickEl.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;

            // Normalize output (-1 to 1)
            stick.x = dx / maxDist;
            stick.y = dy / maxDist;
        }

        // Touch Events
        zone.addEventListener('touchstart', e => handleInput(e.touches[0].clientX, e.touches[0].clientY));
        zone.addEventListener('touchmove', e => { e.preventDefault(); handleInput(e.touches[0].clientX, e.touches[0].clientY); });
        zone.addEventListener('touchend', () => handleInput(0, 0, true));

        // Mouse Events (for desktop testing)
        let isDragging = false;
        zone.addEventListener('mousedown', e => { isDragging = true; handleInput(e.clientX, e.clientY); });
        window.addEventListener('mousemove', e => { if(isDragging) handleInput(e.clientX, e.clientY); });
        window.addEventListener('mouseup', () => { isDragging = false; handleInput(0, 0, true); });


        // --- GAME LOOP ---
        const modal = document.getElementById('interaction-modal');
        const titleEl = document.getElementById('modal-title');
        const descEl = document.getElementById('modal-desc');
        const linkEl = document.getElementById('modal-link');
        let activePoi = null;

        function animate() {
            requestAnimationFrame(animate);

            // Movement Logic
            if (stick.active || stick.x !== 0 || stick.y !== 0) {
                // Move relative to camera not implemented for simplicity, absolute X/Z movement
                // Use small deadzone
                if(Math.abs(stick.x) > 0.1 || Math.abs(stick.y) > 0.1) {
                    player.position.x += stick.x * 0.15;
                    player.position.z += stick.y * 0.15;
                    player.lookAt(player.position.x + stick.x, player.position.y, player.position.z + stick.y);
                }
            }

            // Update Lantern Position
            playerLight.position.copy(player.position);
            playerLight.position.y += 1;

            // Camera Follow
            const camOffset = new THREE.Vector3(0, 15, 12); // High angle
            camera.position.lerp(player.position.clone().add(camOffset), 0.1);
            camera.lookAt(player.position);

            // Check POI Distance
            let nearAny = false;
            poiObjects.forEach(poi => {
                const dist = player.position.distanceTo(poi.position);
                
                // Rotate sign to face player
                poi.lookAt(player.position.x, poi.position.y, player.position.z);

                if (dist < 3) {
                    nearAny = true;
                    if (activePoi !== poi) {
                        // Open Modal
                        activePoi = poi;
                        titleEl.innerText = poi.userData.label;
                        descEl.innerText = poi.userData.desc;
                        linkEl.href = poi.userData.link;
                        modal.classList.add('active');
                    }
                }
            });

            if (!nearAny && activePoi) {
                modal.classList.remove('active');
                activePoi = null;
            }

            renderer.render(scene, camera);
        }

        // Resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

    </script>
</body>
</html>
