<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Open881 - WebGL RPG</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Courier New', Courier, monospace; background: #000; }
        
        /* UI OVERLAY CONTAINER */
        #game-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        /* INTERACTIVE ELEMENTS */
        .interactive { pointer-events: auto; }

        /* --- MINIMAP (FIXED: Moved to Top Left to avoid Backpack) --- */
        #minimap-container {
            position: absolute; top: 10px; left: 10px; 
            width: 150px; height: 150px; 
            pointer-events: none; 
            z-index: 10;
        }
        #minimap-canvas {
            border-radius: 50%; 
            background: black; 
            border: 4px solid #5c4033;
            box-shadow: 0 4px 6px rgba(0,0,0,0.5);
        }

        /* --- CHAT BOX (Bottom Left) --- */
        #chat-box {
            position: absolute; bottom: 10px; left: 10px;
            width: 300px; height: 150px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #555;
            display: flex; flex-direction: column;
            pointer-events: auto;
        }
        #chat-list {
            flex: 1; overflow-y: auto; padding: 5px;
            color: white; font-size: 14px;
            text-shadow: 1px 1px 0 #000;
        }
        #chat-input {
            background: rgba(0,0,0,0.5); border: none; border-top: 1px solid #555;
            color: white; padding: 5px; font-family: inherit; outline: none;
        }

        /* --- RIGHT PANEL (Inventory/Stats) --- */
        #right-panel {
            position: absolute; bottom: 10px; right: 10px;
            width: 220px;
            pointer-events: auto;
        }
        
        .tabs { display: flex; justify-content: space-between; margin-top: 5px; }
        .tab-btn {
            background: #2b3b4b; border: 2px solid #5b6b7b;
            color: white; width: 32%; padding: 5px; cursor: pointer;
            text-align: center; font-size: 20px;
        }
        .tab-btn:hover { background: #3b4b5b; }

        .panel {
            background: rgba(18, 26, 36, 0.9);
            border: 2px solid #3b4b5b;
            padding: 10px; height: 250px;
            display: none; overflow-y: auto;
        }
        .panel.active { display: block; }

        /* --- POPUP WINDOWS (FIXED CSS) --- */
        .panel.window { 
            position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            width: 300px; /* Fixed width prevents header collapse */
            height: auto; 
            display: none; 
            z-index: 100; /* Higher than everything else */
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            pointer-events: auto;
        }

        /* WINDOW HEADER (FIXED) */
        .window-header {
            display: flex; 
            justify-content: space-between;
            align-items: center;
            color: orange; 
            border-bottom: 1px solid #555;
            margin-bottom: 10px; 
            padding-bottom: 5px; 
            font-weight: bold;
            height: 30px; /* Force height so button fits */
        }
        .close-btn { 
            background: #cc0000; 
            color: white; 
            border: 1px solid white; 
            cursor: pointer; 
            width: 30px; height: 30px;
            font-weight: bold;
        }

        /* GRIDS */
        .inv-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; }
        .item-slot {
            width: 40px; height: 40px; background: #3b4b5b;
            border: 1px solid #1b2b3b; position: relative;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; cursor: pointer;
        }
        .item-count {
            position: absolute; top: 0; left: 0;
            color: yellow; font-size: 10px; text-shadow: 1px 1px 0 #000;
        }
        
        .stat-row { display: flex; justify-content: space-between; color: white; margin-bottom: 4px; font-size: 14px; }
        .stat-val { color: yellow; }
        
        .chess-square {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; cursor: pointer;
            user-select: none; /* Prevents text highlighting when clicking fast */
        }
    </style>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <div id="game-container"></div>

    <div id="game-ui">
        <div id="minimap-container">
            <span style="display:block; text-align:center; color:white; font-size:12px; margin-bottom:2px; text-shadow: 1px 1px 0 #000;">World Map</span>
            <canvas id="minimap-canvas" width="150" height="150"></canvas>
        </div>

        <div id="chat-box">
            <div id="chat-list"></div>
            <input id="chat-input" type="text" placeholder="Type here..." autocomplete="off">
        </div>

        <div id="right-panel">
            <div id="tab-inv" class="panel active">
                <div style="color:orange; margin-bottom:5px;">Backpack üí∞ <span id="coin-display">0</span></div>
                <div id="inv-grid" class="inv-grid"></div>
            </div>
            <div id="tab-stats" class="panel">
                <div style="color:orange; margin-bottom:5px;">Stats</div>
                <div class="stat-row"><span>‚öîÔ∏è Attack</span><span id="stat-att" class="stat-val">1</span></div>
                <div class="stat-row"><span>üí™ Strength</span><span id="stat-str" class="stat-val">1</span></div>
                <div class="stat-row"><span>üõ°Ô∏è Defence</span><span id="stat-def" class="stat-val">1</span></div>
                <div class="stat-row"><span>‚ù§Ô∏è Hitpoints</span><span id="stat-hp" class="stat-val">10</span></div>
                <div class="stat-row"><span>üèπ Ranged</span><span id="stat-rng" class="stat-val">1</span></div>
                <div class="stat-row"><span>‚ú® Magic</span><span id="stat-mag" class="stat-val">1</span></div>
                <div class="stat-row"><span>üôè Prayer</span><span id="stat-pra" class="stat-val">1</span></div>
                <hr style="border-color:#333;">
                <div class="stat-row"><span>üå≤ Woodcutting</span><span class="stat-val"><span id="wc-level">1</span> (XP: <span id="wc-xp">0</span>)</span></div>
            </div>
            <div id="tab-magic" class="panel">
                <div style="color:orange; margin-bottom:5px;">Spellbook</div>
                <div class="stat-row" onclick="window.game.teleport('lumbridge')" style="cursor:pointer;">üè† Lumbridge Teleport</div>
                <div class="stat-row" onclick="window.game.teleport('falador')" style="cursor:pointer;">üè∞ Falador Teleport</div>
            </div>
            <div class="tabs">
                <div class="tab-btn" onclick="window.game.switchTab('tab-stats')">üìä</div>
                <div class="tab-btn" onclick="window.game.switchTab('tab-inv')">üéí</div>
                <div class="tab-btn" onclick="window.game.switchTab('tab-magic')">üìò</div>
            </div>
        </div>

        <div id="bank-window" class="panel window">
            <div class="window-header">
                <span>Bank</span>
                <button class="close-btn" onclick="window.game.closeWindows()">X</button>
            </div>
            <div id="bank-grid" class="inv-grid"></div>
        </div>

        <div id="shop-window" class="panel window">
            <div class="window-header">
                <span>Store</span>
                <button class="close-btn" onclick="window.game.closeWindows()">X</button>
            </div>
            <div id="shop-grid" class="inv-grid"></div>
        </div>

        <div id="chess-window" class="panel window">
            <div class="window-header">
                <span>Chess</span>
                <button class="close-btn" onclick="window.game.closeWindows()">X</button>
            </div>
            <div id="chess-grid" style="
                display: grid; 
                grid-template-columns: repeat(8, 1fr); 
                grid-template-rows: repeat(8, 1fr);
                width: 280px; 
                height: 280px; 
                border: 4px solid #5c4033;
                margin: 0 auto; /* Center board */
            "></div>
        </div>
    </div>

    <script type="module">
        import { initGame } from './main.js';
        window.onload = initGame;
    </script>
</body>
</html>
