<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Open881 - Debug Mode</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Trebuchet MS', sans-serif; touch-action: none; }
        #game-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        /* --- DEBUG ERROR BOX --- */
        #debug-console {
            position: absolute; top: 50px; left: 10px; width: 90%; 
            background: rgba(50, 0, 0, 0.9); border: 2px solid red; 
            color: #ffcccc; padding: 10px; font-family: monospace; 
            z-index: 99999; pointer-events: none; display: none;
        }

        /* UI STYLES */
        #context-text { position: absolute; top: 10px; left: 10px; color: #00ff00; font-weight: bold; font-size: 16px; }
        .center-window { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; background: #081218; border: 2px solid #5a7b8f; display: none; flex-direction: column; pointer-events: auto; }
        .win-header { background: #152936; color: #ffd700; padding: 10px; display: flex; justify-content: space-between; }
        .win-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; padding: 10px; }
        .item-slot { width: 40px; height: 40px; background: #2b3945; border: 1px solid #3c4b57; display: flex; align-items: center; justify-content: center; position: relative; color: #fff; }
        .item-count { position: absolute; top: 1px; left: 2px; color: #ffd700; font-size: 10px; }
        #tabs-container { position: absolute; bottom: 10px; right: 10px; display: flex; flex-direction: column; align-items: flex-end; gap: 5px; pointer-events: auto; }
        .panel { width: 200px; background: rgba(8, 30, 43, 0.95); border: 2px solid #3c4b57; padding: 10px; display: none; margin-bottom: 5px; }
        .panel.active { display: block; }
        .tab-icons { display: flex; gap: 5px; }
        .tab-btn { width: 45px; height: 45px; background: #1a2a36; border: 2px solid #5a7b8f; color: #ffd700; display: flex; align-items: center; justify-content: center; font-size: 22px; cursor: pointer; }
    </style>

    <script>
        window.onerror = function(msg, url, line, col, error) {
            const box = document.getElementById('debug-console');
            box.style.display = 'block';
            box.innerHTML += `<b>ERROR:</b> ${msg}<br>File: ${url.split('/').pop()} (Line ${line})<br><hr>`;
            return false;
        };
        // Catch Promise rejections (like missing imports)
        window.addEventListener('unhandledrejection', function(event) {
            const box = document.getElementById('debug-console');
            box.style.display = 'block';
            box.innerHTML += `<b>LOAD ERROR:</b> ${event.reason}<br>Check if all files are uploaded!<br><hr>`;
        });
    </script>
    
    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>
</head>
<body>

    <div id="debug-console"></div>

    <div id="game-ui">
        <div id="context-text">Welcome to Open881</div>

        <div id="bank-window" class="center-window">
            <div class="win-header"><span>üè¶ Bank</span><span onclick="game.closeWindows()">‚úñ</span></div>
            <div class="win-grid" id="bank-grid"></div>
        </div>

        <div id="shop-window" class="center-window">
            <div class="win-header"><span>üè™ Store</span><span onclick="game.closeWindows()">‚úñ</span></div>
            <div class="win-grid" id="shop-grid"></div>
        </div>
        
        <div id="tabs-container">
            <div id="panel-skills" class="panel">
                <div style="color:#00ccff; border-bottom:1px solid #5a7b8f;">Stats</div>
                <div style="color:#ffd700;">üå≤ WC: <span id="wc-level">1</span> (XP: <span id="wc-xp">0</span>)</div>
            </div>

            <div id="panel-inv" class="panel active">
                <div style="color:#ffd700; border-bottom:1px solid #5a7b8f;">Backpack üí∞ <span id="coin-display">0</span></div>
                <div class="win-grid" id="inv-grid" style="padding:0; grid-template-columns: repeat(4, 1fr);"></div>
            </div>

            <div id="panel-magic" class="panel">
                <div style="color:#00ccff; border-bottom:1px solid #5a7b8f;">Teleports</div>
                <div style="display:flex; gap:5px; margin-top:5px;">
                    <button onclick="game.teleport('lumbridge')">Lum</button>
                    <button onclick="game.teleport('falador')">Fal</button>
                    <button onclick="game.teleport('menaphos')">Men</button>
                </div>
            </div>

            <div class="tab-icons">
                <div class="tab-btn" onclick="switchTab('panel-skills')">üìä</div>
                <div class="tab-btn" onclick="switchTab('panel-inv')">üéí</div>
                <div class="tab-btn" onclick="switchTab('panel-magic')">üìò</div>
            </div>
        </div>
    </div>

    <script>
        function switchTab(id) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>

    <script type="module">
        import { initGame, triggerTeleport, closeWindows } from './main.js';
        window.game = { teleport: triggerTeleport, closeWindows: closeWindows };
        initGame();
    </script>
</body>
</html>
