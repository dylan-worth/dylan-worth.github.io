<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Open881 - 3D Client</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Trebuchet MS', sans-serif; touch-action: none; }
        
        /* --- GAME LAYER --- */
        #game-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        /* --- CONTEXT TEXT (Top Left) --- */
        #context-text {
            position: absolute; top: 10px; left: 10px;
            color: #00ff00; font-weight: bold; text-shadow: 1px 1px 0 #000;
            font-size: 16px; pointer-events: none;
        }

        /* --- CENTER WINDOWS (Bank / Shop) --- */
        .center-window {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 300px; background: #081218; border: 2px solid #5a7b8f;
            display: none; flex-direction: column; pointer-events: auto;
            box-shadow: 0 0 20px #000; z-index: 100;
        }
        .win-header { background: #152936; color: #ffd700; padding: 10px; font-weight: bold; display: flex; justify-content: space-between; }
        .win-close { cursor: pointer; color: #ff5555; font-weight: bold; }
        .win-close:hover { color: #ff0000; }
        .win-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; padding: 10px; max-height: 200px; overflow-y: auto; }

        /* --- ITEM SLOT --- */
        .item-slot {
            width: 40px; height: 40px; background: #2b3945; border: 1px solid #3c4b57;
            display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;
            cursor: pointer; color: #fff;
        }
        .item-slot:hover { border-color: #ffd700; background: #3c4b57; }
        .item-count { position: absolute; top: 1px; left: 2px; color: #ffd700; font-size: 10px; text-shadow: 1px 1px 0 #000; }

        /* --- BOTTOM RIGHT TABS --- */
        #tabs-container {
            position: absolute; bottom: 10px; right: 10px;
            display: flex; flex-direction: column; align-items: flex-end; gap: 5px;
            pointer-events: auto;
        }

        /* --- PANELS (Inventory / Magic) --- */
        .panel { 
            width: 200px; background: rgba(8, 30, 43, 0.95); border: 2px solid #3c4b57; 
            padding: 10px; display: none; margin-bottom: 5px; 
        }
        .panel.active { display: block; }

        /* SPELL GRID */
        .spell-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .spell { 
            background: #000; border: 1px solid #5a7b8f; aspect-ratio: 1; 
            display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px;
        }
        .spell:hover { border-color: #ffd700; }

        /* TAB ICONS */
        .tab-icons { display: flex; gap: 5px; }
        .tab-btn {
            width: 45px; height: 45px; background: #1a2a36; border: 2px solid #5a7b8f;
            color: #ffd700; display: flex; align-items: center; justify-content: center;
            font-size: 22px; cursor: pointer; border-radius: 5px;
        }
        .tab-btn:hover { border-color: #00ccff; background: #2b3945; }

        /* --- ERROR OVERLAY --- */
        #error-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #110000; color: #ff5555; display: none;
            flex-direction: column; align-items: center; justify-content: center; text-align: center;
            z-index: 9999; font-family: monospace; padding: 20px;
        }
    </style>
    
    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>
</head>
<body>

    <div id="error-overlay">
        <h1>‚ö†Ô∏è Game Crashed</h1>
        <p>If you see this, a script failed to load.</p>
        <p id="error-msg">Check console (F12) for details.</p>
    </div>

    <div id="game-ui">
        <div id="context-text">Welcome to Open881</div>

        <div id="bank-window" class="center-window">
            <div class="win-header">
                <span>üè¶ Bank of Gielinor</span>
                <span class="win-close" onclick="window.game.closeWindows()">‚úñ</span>
            </div>
            <div class="win-grid" id="bank-grid"></div>
        </div>

        <div id="shop-window" class="center-window">
            <div class="win-header">
                <span>üè™ General Store</span>
                <span class="win-close" onclick="window.game.closeWindows()">‚úñ</span>
            </div>
            <div class="win-grid" id="shop-grid"></div>
        </div>
        
        <div id="tabs-container">
            
            <div id="panel-skills" class="panel">
                <div style="color:#00ccff; margin-bottom:5px; font-weight:bold; font-size:14px; border-bottom:1px solid #5a7b8f; padding-bottom:5px;">Stats</div>
                <div style="display:flex; justify-content:space-between; color:#ffd700; font-size:12px;">
                    <span>üå≤ Woodcutting</span>
                    <span id="wc-level">1</span>
                </div>
                <div style="text-align:right; font-size:10px; color:#aaa;">XP: <span id="wc-xp">0</span></div>
            </div>

            <div id="panel-inv" class="panel active">
                <div style="color:#ffd700; margin-bottom:5px; font-weight:bold; font-size:14px; border-bottom:1px solid #5a7b8f; padding-bottom:5px;">
                    Backpack <span style="float:right; color:#ffd700">üí∞ <span id="coin-display">0</span></span>
                </div>
                <div class="win-grid" id="inv-grid" style="padding:0; grid-template-columns: repeat(4, 1fr); max-height:none;"></div>
            </div>

            <div id="panel-magic" class="panel">
                <div style="color:#00ccff; margin-bottom:5px; font-weight:bold; font-size:14px; border-bottom:1px solid #5a7b8f; padding-bottom:5px;">Teleports</div>
                <div class="spell-grid">
                    <div class="spell" onclick="window.game.teleport('lumbridge')" title="Lumbridge Home">üè∞</div>
                    <div class="spell" onclick="window.game.teleport('falador')" title="Falador Park">üõ°Ô∏è</div>
                    <div class="spell" onclick="window.game.teleport('menaphos')" title="Menaphos">üèúÔ∏è</div>
                </div>
            </div>

            <div class="tab-icons">
                <div class="tab-btn" onclick="switchTab('panel-skills')">üìä</div>
                <div class="tab-btn" onclick="switchTab('panel-inv')">üéí</div>
                <div class="tab-btn" onclick="switchTab('panel-magic')">üìò</div>
            </div>
        </div>
    </div>

    <script>
        function switchTab(id) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>

    <script type="module">
        import { initGame, triggerTeleport, closeWindows } from './main.js';
        
        // Expose functions to HTML buttons
        window.game = {
            teleport: triggerTeleport,
            closeWindows: closeWindows
        };

        // Catch errors to prevent black screen confusion
        try {
            initGame();
        } catch (e) {
            console.error(e);
            document.getElementById('error-overlay').style.display = 'flex';
            document.getElementById('error-msg').innerText = e.message;
        }
    </script>
</body>
</html>
