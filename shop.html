<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SMB Assessments â€“ 3D Merch Shop</title>
  <style>
    html, body { margin: 0; height: 100%; overflow: hidden; background: #0b0f10; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    #ui { position: fixed; inset: 0; pointer-events: none; }
    #hud { position: absolute; top: 0; left: 0; right: 0; display: flex; justify-content: space-between; align-items: center; gap: .5rem; padding: .75rem 1rem; pointer-events: none; }
    .badge { pointer-events: auto; background: rgba(255,255,255,0.08); color: #e5f2ff; padding: .4rem .7rem; border: 1px solid rgba(255,255,255,0.15); border-radius: 999px; backdrop-filter: blur(8px); font-size: .85rem; }
    #cartBtn { pointer-events: auto; }
    #hint { pointer-events: none; opacity: .9; }
    #centerDot { position: absolute; top: 50%; left: 50%; width: 6px; height: 6px; margin-left: -3px; margin-top: -3px; background: #b6ff53; border-radius: 50%; box-shadow: 0 0 8px #b6ff53; opacity: .8; }/* Product Panel */
#productPanel, #cartPanel, #startOverlay { position: absolute; inset: 0; display: grid; place-items: center; background: rgba(0,0,0,0.45); backdrop-filter: blur(6px); padding: 1rem; pointer-events: none; opacity: 0; transition: opacity .2s ease; }
.panelInner { pointer-events: auto; width: min(720px, 92vw); max-height: 86vh; overflow: auto; background: #0e1416; border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.55); }
.panelHeader { display: flex; justify-content: space-between; align-items: center; padding: .9rem 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; background: #0e1416; z-index: 2; }
.panelBody { padding: 1rem; display: grid; grid-template-columns: 1fr 1.2fr; gap: 1rem; }
.panelBody img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 12px; background: #0a0f11; }
.title { font-weight: 700; color: #eaffc2; letter-spacing: .2px; }
.price { color: #b6ff53; font-size: 1.1rem; }
.btn { background: #b6ff53; color: #051006; border: none; padding: .7rem 1rem; border-radius: 12px; font-weight: 700; cursor: pointer; }
.btn.secondary { background: transparent; color: #e5f2ff; border: 1px solid rgba(255,255,255,0.2); }
.btn:active { transform: translateY(1px); }

#startOverlay .panelInner { width: min(560px, 92vw); text-align: center; }
#startOverlay p { color: #d6f2ff; opacity: .88; }

/* Mobile controls */
#stick { position: absolute; bottom: 8vh; left: 5vw; width: 130px; height: 130px; border-radius: 50%; background: rgba(255,255,255,0.04); border: 1px dashed rgba(255,255,255,0.2); display: none; pointer-events: auto; }
#stick .knob { position: absolute; left: 50%; top: 50%; width: 64px; height: 64px; margin-left: -32px; margin-top: -32px; border-radius: 50%; background: rgba(182,255,83,0.85); box-shadow: 0 0 12px rgba(182,255,83,0.8); }
#look { position: absolute; bottom: 8vh; right: 5vw; width: 130px; height: 130px; border-radius: 50%; background: rgba(255,255,255,0.04); border: 1px dashed rgba(255,255,255,0.2); display: none; pointer-events: auto; }
#look .knob { position: absolute; left: 50%; top: 50%; width: 64px; height: 64px; margin-left: -32px; margin-top: -32px; border-radius: 50%; background: rgba(255,255,255,0.28); box-shadow: 0 0 12px rgba(255,255,255,0.25); }

@media (max-width: 768px) {
  .panelBody { grid-template-columns: 1fr; }
}

/* Utility */
.hidden { display: none !important; }
.show { opacity: 1 !important; pointer-events: auto !important; }

  </style>
</head>
<body>
  <div id="ui">
    <div id="hud">
      <div class="badge" id="hint">Click to enter â€¢ WASD/Arrows to move â€¢ Mouse to look â€¢ E to interact</div>
      <div style="display:flex; gap:.5rem; align-items:center">
        <div class="badge" id="fps">FPS: --</div>
        <button id="cartBtn" class="badge">ðŸ§º Cart <span id="cartCount">0</span></button>
      </div>
    </div>
    <div id="centerDot"></div><div id="startOverlay" class="show">
  <div class="panelInner">
    <div class="panelHeader">
      <div class="title">Welcome to the SMB 3D Shop</div>
      <button class="btn secondary" id="enterBtn">Enter</button>
    </div>
    <div class="panelBody" style="grid-template-columns:1fr;">
      <p>Desktop: click <strong>Enter</strong>, then use <strong>WASD</strong> or <strong>Arrow Keys</strong> to walk. Move the mouse to look around. 
      Press <strong>E</strong> on items to view details.</p>
      <p>Mobile: tap <strong>Enter</strong>, then use the onâ€‘screen joysticks to move and look.</p>
      <p style="margin:0; opacity:.7">P.S. If you bump into invisible walls, thatâ€™s our lossâ€‘prevention system. Totally intentional. Definitely not me forgetting collision math. ðŸ«£</p>
    </div>
  </div>
</div>

<div id="productPanel">
  <div class="panelInner">
    <div class="panelHeader">
      <div class="title" id="pTitle">Item</div>
      <div style="display:flex; gap:.5rem; align-items:center">
        <div class="price" id="pPrice">$00.00</div>
        <button class="btn secondary" id="closeProduct">Close</button>
      </div>
    </div>
    <div class="panelBody">
      <img id="pImg" alt="Product image" />
      <div>
        <p id="pDesc" style="color:#d6f2ff; line-height:1.4"></p>
        <div style="display:flex; gap:.5rem; flex-wrap:wrap; margin-top: .5rem;">
          <button class="btn" id="addToCart">Add to cart</button>
          <button class="btn secondary" id="viewInRoom">Place in room (AR-ish)</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="cartPanel">
  <div class="panelInner">
    <div class="panelHeader">
      <div class="title">Your Cart</div>
      <div style="display:flex; gap:.5rem; align-items:center">
        <div class="price" id="cartTotal">$0.00</div>
        <button class="btn secondary" id="closeCart">Close</button>
      </div>
    </div>
    <div class="panelBody" style="grid-template-columns:1fr;">
      <div id="cartList" style="display:flex; flex-direction:column; gap:.75rem"></div>
      <button class="btn" id="checkoutBtn">Checkout (demo)</button>
    </div>
  </div>
</div>

<div id="stick"><div class="knob"></div></div>
<div id="look"><div class="knob"></div></div>

  </div><canvas id="c"></canvas>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.161.0/build/three.module.js";
    import { PointerLockControls } from "https://unpkg.com/three@0.161.0/examples/jsm/controls/PointerLockControls.js";

    // --- Basic Setup ---
    const canvas = document.getElementById('c');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(innerWidth, innerHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;

    const scene = new THREE.Scene();
    scene.background = new THREE.Color('#0b0f10');

    const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 100);
    camera.position.set(0, 1.6, 6);

    const controls = new PointerLockControls(camera, document.body);

    // Lights
    const hemi = new THREE.HemisphereLight(0xc9f7ff, 0x1b2a2f, 0.7);
    scene.add(hemi);
    const spot = new THREE.SpotLight(0xb6ff53, 2, 30, Math.PI/5, 0.3, 1);
    spot.position.set(0, 6, 0);
    spot.target.position.set(0,0,0);
    scene.add(spot, spot.target);

    // Room (simple box room)
    const room = new THREE.Group();
    const roomSize = { w: 14, h: 4, d: 18 };
    const wallMat = new THREE.MeshStandardMaterial({ color: 0x0e1416, roughness: .9, metalness: 0 });
    const floorMat = new THREE.MeshStandardMaterial({ color: 0x111a1d, roughness: .95 });
    const trimMat  = new THREE.MeshStandardMaterial({ color: 0x152226, roughness: .8 });

    const floor = new THREE.Mesh(new THREE.PlaneGeometry(roomSize.w, roomSize.d), floorMat);
    floor.rotation.x = -Math.PI/2;
    floor.position.y = 0;
    room.add(floor);

    const ceil = new THREE.Mesh(new THREE.PlaneGeometry(roomSize.w, roomSize.d), trimMat);
    ceil.rotation.x = Math.PI/2;
    ceil.position.y = roomSize.h;
    room.add(ceil);

    const wallGeomW = new THREE.PlaneGeometry(roomSize.w, roomSize.h);
    const wallGeomD = new THREE.PlaneGeometry(roomSize.d, roomSize.h);

    const backWall = new THREE.Mesh(wallGeomW, wallMat); backWall.position.set(0, roomSize.h/2, -roomSize.d/2); backWall.rotation.y = Math.PI; room.add(backWall);
    const frontWall= new THREE.Mesh(wallGeomW, wallMat); frontWall.position.set(0, roomSize.h/2,  roomSize.d/2); room.add(frontWall);
    const leftWall = new THREE.Mesh(wallGeomD, wallMat); leftWall.position.set(-roomSize.w/2, roomSize.h/2, 0); leftWall.rotation.y = Math.PI/2; room.add(leftWall);
    const rightWall= new THREE.Mesh(wallGeomD, wallMat); rightWall.position.set( roomSize.w/2, roomSize.h/2, 0); rightWall.rotation.y = -Math.PI/2; room.add(rightWall);

    // Simple neon sign
    const signGroup = new THREE.Group();
    const signBG = new THREE.Mesh(new THREE.PlaneGeometry(5, 1.6), new THREE.MeshStandardMaterial({ color: 0x061214, roughness: 1 }));
    signBG.position.set(0, 2.6, -roomSize.d/2 + .01);
    const signFrame = new THREE.Mesh(new THREE.RingGeometry(0.02, 0.03, 32), new THREE.MeshBasicMaterial({ color: 0xb6ff53 }));
    // text as rectangles (pseudo)
    const letters = [];
    const letterGeom = new THREE.BoxGeometry(0.12, 0.02, 0.03);
    const neonMat = new THREE.MeshBasicMaterial({ color: 0xb6ff53 });
    const text = "SMB SHOP";
    let x = -1.6;
    for (const ch of text) {
      const group = new THREE.Group();
      if (ch !== ' ') {
        for (let i = 0; i < 6; i++) {
          const seg = new THREE.Mesh(letterGeom, neonMat);
          seg.position.set((Math.random()-.5)*.1, (Math.random()-.5)*.2, 0);
          group.add(seg);
        }
      }
      group.position.set(x, 2.6, -roomSize.d/2 + .02);
      letters.push(group); scene.add(group);
      x += .45;
    }
    scene.add(signBG, signGroup);

    // Pedestals + products (clickable)
    const products = [
      {
        id: 'hat', title: 'SMB Assessments Hat', price: 24.00,
        img: 'https://images.unsplash.com/photo-1521572267360-ee0c2909d518?q=80&w=800&auto=format&fit=crop',
        desc: 'Black trucker hat with embroidered "SMB Assessments". Fieldâ€‘tested in attics and crawlspaces. Sweatâ€‘resistant, swaggerâ€‘approved.'
      },
      {
        id: 'tee', title: 'Spora Tee', price: 28.00,
        img: 'https://images.unsplash.com/photo-1602810318383-9e39be986394?q=80&w=800&auto=format&fit=crop',
        desc: 'Ultraâ€‘soft cotton tee featuring Spora, your favorite friendly spore. Looks crisp under negative air.'
      },
      {
        id: 'hoodie', title: 'Mold Meadows Hoodie', price: 52.00,
        img: 'https://images.unsplash.com/photo-1576871337622-98d48d1cf531?q=80&w=800&auto=format&fit=crop',
        desc: 'Cozy heavyweight hoodie. Perfect for lateâ€‘night protocol writing and coffeeâ€‘powered coding.'
      }
    ];

    const clickable = [];
    const pedestalMat = new THREE.MeshStandardMaterial({ color: 0x152226, roughness: .6, metalness: .05 });

    function addProduct(p, i){
      const g = new THREE.Group();
      // Pedestal
      const ped = new THREE.Mesh(new THREE.CylinderGeometry(0.6, 0.7, 0.4, 24), pedestalMat);
      ped.position.y = 0.2;
      g.add(ped);
      // Box with image as texture
      const tex = new THREE.TextureLoader();
      const boxGeo = new THREE.BoxGeometry(0.9, 1, 0.2);
      const meshMats = [
        new THREE.MeshStandardMaterial({color: 0x0d1517}),
        new THREE.MeshStandardMaterial({color: 0x0d1517}),
        new THREE.MeshStandardMaterial({color: 0x0d1517}),
        new THREE.MeshStandardMaterial({color: 0x0d1517}),
        new THREE.MeshStandardMaterial({color: 0x0d1517}),
        new THREE.MeshStandardMaterial({map: tex.load(p.img)})
      ];
      const box = new THREE.Mesh(boxGeo, meshMats);
      box.position.y = 1;
      box.userData.product = p;
      g.add(box);

      const label = makeLabelSprite(`${p.title} â€” $${p.price.toFixed(2)}`);
      label.position.set(0, 1.8, 0);
      g.add(label);

      const spacing = 4.5;
      g.position.set(-spacing + i*spacing, 0, -1.5);
      scene.add(g);
      clickable.push(box);
    }

    products.forEach(addProduct);

    scene.add(room);

    // Label helper
    function makeLabelSprite(text){
      const canvas = document.createElement('canvas');
      canvas.width = 512; canvas.height = 128;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#0b0f10';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#b6ff53';
      ctx.font = '28px sans-serif';
      ctx.textBaseline = 'middle';
      ctx.fillText(text, 20, canvas.height/2);
      const tex = new THREE.CanvasTexture(canvas);
      const mat = new THREE.SpriteMaterial({ map: tex, transparent: false });
      const sprite = new THREE.Sprite(mat);
      sprite.scale.set(2.5, 0.6, 1);
      return sprite;
    }

    // --- Movement ---
    const velocity = new THREE.Vector3();
    const direction = new THREE.Vector3();
    const keys = { w:false, a:false, s:false, d:false, ArrowUp:false, ArrowLeft:false, ArrowDown:false, ArrowRight:false };

    const onKey = (e, down) => {
      if (['w','a','s','d','ArrowUp','ArrowLeft','ArrowDown','ArrowRight','e','E'].includes(e.key)) e.preventDefault();
      if (keys.hasOwnProperty(e.key)) keys[e.key] = down;
      if (down && (e.key === 'e' || e.key === 'E')) tryInteract();
    };
    window.addEventListener('keydown', e=>onKey(e,true));
    window.addEventListener('keyup', e=>onKey(e,false));

    function move(delta){
      direction.z = Number(keys.w || keys.ArrowUp) - Number(keys.s || keys.ArrowDown);
      direction.x = Number(keys.d || keys.ArrowRight) - Number(keys.a || keys.ArrowLeft);
      direction.normalize();
      const speed = 3.0;
      if (controls.isLocked || isMobile) {
        velocity.z = -direction.z * speed * delta;
        velocity.x =  direction.x * speed * delta;
        const camDir = new THREE.Vector3(); camera.getWorldDirection(camDir);
        const right = new THREE.Vector3(); right.crossVectors(camDir, new THREE.Vector3(0,1,0));
        const moveVec = new THREE.Vector3();
        moveVec.addScaledVector(camDir.setY(0).normalize(), velocity.z);
        moveVec.addScaledVector(right.setY(0).normalize(), velocity.x);
        const next = camera.position.clone().add(moveVec);
        // Collision with room bounds
        const margin = 0.4;
        next.x = THREE.MathUtils.clamp(next.x, -roomSize.w/2 + margin, roomSize.w/2 - margin);
        next.z = THREE.MathUtils.clamp(next.z, -roomSize.d/2 + margin, roomSize.d/2 - margin);
        camera.position.copy(next);
      }
    }

    // --- Interaction (Raycast center) ---
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2(0,0);
    function tryInteract(){
      raycaster.setFromCamera(mouse, camera);
      const hits = raycaster.intersectObjects(clickable, false);
      if (hits.length){ openProduct(hits[0].object.userData.product); }
    }

    // --- UI Logic ---
    const productPanel = document.getElementById('productPanel');
    const cartPanel = document.getElementById('cartPanel');
    const pTitle = document.getElementById('pTitle');
    const pPrice = document.getElementById('pPrice');
    const pImg = document.getElementById('pImg');
    const pDesc = document.getElementById('pDesc');
    const addToCartBtn = document.getElementById('addToCart');
    const viewInRoomBtn = document.getElementById('viewInRoom');
    const cartBtn = document.getElementById('cartBtn');
    const cartList = document.getElementById('cartList');
    const cartTotal = document.getElementById('cartTotal');
    const cartCount = document.getElementById('cartCount');
    const closeProduct = document.getElementById('closeProduct');
    const closeCart = document.getElementById('closeCart');
    const enterBtn = document.getElementById('enterBtn');
    const startOverlay = document.getElementById('startOverlay');

    let currentProduct = null;
    let cart = [];

    function openProduct(p){
      currentProduct = p;
      pTitle.textContent = p.title;
      pPrice.textContent = `$${p.price.toFixed(2)}`;
      pImg.src = p.img;
      pDesc.textContent = p.desc;
      productPanel.classList.add('show');
    }
    function closeProductPanel(){ productPanel.classList.remove('show'); currentProduct = null; }

    function renderCart(){
      cartList.innerHTML = '';
      let total = 0;
      for (const item of cart){
        total += item.price * item.qty;
        const row = document.createElement('div');
        row.style.display = 'grid';
        row.style.gridTemplateColumns = '56px 1fr auto auto';
        row.style.alignItems = 'center';
        row.style.gap = '.6rem';
        row.innerHTML = `
          <img src="${item.img}" alt="${item.title}" style="width:56px;height:56px;object-fit:cover;border-radius:8px;background:#0a0f11"/>
          <div>
            <div class="title" style="font-size: .95rem; color:#e5f2ff">${item.title}</div>
            <div class="price">$${item.price.toFixed(2)}</div>
          </div>
          <div style="display:flex; gap:.4rem; align-items:center">
            <button class="btn secondary" data-id="${item.id}" data-act="dec">âˆ’</button>
            <div style="min-width:2ch; text-align:center; color:#e5f2ff">${item.qty}</div>
            <button class="btn secondary" data-id="${item.id}" data-act="inc">+</button>
          </div>
          <button class="btn secondary" data-id="${item.id}" data-act="del">Remove</button>
        `;
        cartList.appendChild(row);
      }
      cartTotal.textContent = `$${total.toFixed(2)}`;
      cartCount.textContent = String(cart.reduce((a,b)=>a+b.qty,0));
    }

    function addToCart(p){
      const found = cart.find(i=>i.id===p.id);
      if (found) found.qty++; else cart.push({ ...p, qty: 1 });
      renderCart();
    }

    addToCartBtn.addEventListener('click', ()=>{ if (currentProduct){ addToCart(currentProduct); closeProductPanel(); cartPanel.classList.add('show'); }});
    viewInRoomBtn.addEventListener('click', ()=>{
      if (!currentProduct) return;
      // spawn a billboard of the product in front of the camera (fake AR)
      const tex = new THREE.TextureLoader().load(currentProduct.img);
      const plane = new THREE.Mesh(new THREE.PlaneGeometry(1.2,1.2), new THREE.MeshBasicMaterial({ map: tex }));
      const forward = new THREE.Vector3(); camera.getWorldDirection(forward);
      plane.position.copy(camera.position).add(forward.multiplyScalar(2));
      plane.position.y = 1.3;
      scene.add(plane);
      closeProductPanel();
    });

    closeProduct.addEventListener('click', closeProductPanel);
    cartBtn.addEventListener('click', ()=>{ cartPanel.classList.add('show'); });
    closeCart.addEventListener('click', ()=> cartPanel.classList.remove('show'));

    cartList.addEventListener('click', (e)=>{
      const t = e.target; if (!(t instanceof HTMLElement)) return;
      const id = t.getAttribute('data-id'); const act = t.getAttribute('data-act');
      if (!id || !act) return;
      const item = cart.find(i=>i.id===id); if (!item) return;
      if (act==='inc') item.qty++;
      if (act==='dec') item.qty = Math.max(1, item.qty-1);
      if (act==='del') cart = cart.filter(i=>i.id!==id);
      renderCart();
    });

    document.getElementById('checkoutBtn').addEventListener('click', ()=>{
      alert('Demo checkout â€“ plug in your real payment flow later.');
    });

    // --- Enter / Pointer Lock ---
    function isTouch(){ return 'ontouchstart' in window || navigator.maxTouchPoints>0; }
    const isMobile = isTouch();

    const stick = document.getElementById('stick');
    const look = document.getElementById('look');

    if (isMobile){
      stick.style.display = 'block';
      look.style.display = 'block';
      document.getElementById('hint').textContent = 'Use joysticks to move and look â€¢ Tap item to view';
    }

    enterBtn.addEventListener('click', ()=>{
      startOverlay.classList.remove('show');
      if (!isMobile) {
        controls.lock();
      }
    });

    controls.addEventListener('lock', ()=>{
      document.getElementById('hint').textContent = 'WASD/Arrows to move â€¢ E to interact â€¢ Esc to release mouse';
    });
    controls.addEventListener('unlock', ()=>{
      document.getElementById('hint').textContent = 'Click to enter â€¢ WASD/Arrows to move â€¢ E to interact';
    });

    // --- Mobile virtual joysticks ---
    function setupStick(el, cb){
      const knob = el.querySelector('.knob');
      let active = false, id = null;
      let center = { x: 0, y: 0 };
      function start(e){ active = true; id = (e.changedTouches? e.changedTouches[0].identifier : 'mouse'); const r = el.getBoundingClientRect(); center.x = r.left + r.width/2; center.y = r.top + r.height/2; }
      function move(e){ if (!active) return; const point = (e.changedTouches? [...e.changedTouches].find(t=>t.identifier===id) : e); if (!point) return; const dx = point.clientX - center.x; const dy = point.clientY - center.y; const max = el.clientWidth/2 - 8; const len = Math.hypot(dx, dy); const nx = (len? dx/len:0) * Math.min(len, max)/max; const ny = (len? dy/len:0) * Math.min(len, max)/max; knob.style.transform = `translate(${nx*max}px, ${ny*max}px)`; cb(nx, ny); }
      function end(){ active = false; knob.style.transform = 'translate(0,0)'; cb(0,0); }
      el.addEventListener('touchstart', start); el.addEventListener('touchmove', move); el.addEventListener('touchend', end); el.addEventListener('mousedown', start); window.addEventListener('mousemove', move); window.addEventListener('mouseup', end);
    }

    if (isMobile){
      setupStick(stick, (nx, ny)=>{ keys.w = ny < -0.2; keys.s = ny > 0.2; keys.a = nx < -0.2; keys.d = nx > 0.2; });
      setupStick(look, (nx, ny)=>{ camera.rotation.y -= nx * 0.06; camera.rotation.x -= ny * 0.04; camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x)); });
    }

    // --- Render Loop ---
    const fpsEl = document.getElementById('fps');
    let last = performance.now(); let acc = 0; let frames = 0;
    function tick(now){
      const dt = Math.min(0.05, (now - last)/1000); last = now;
      move(dt);

      // subtle sign pulse
      const pulse = (Math.sin(now*0.003)+1)/2; spot.intensity = 1.5 + pulse*0.5;

      renderer.render(scene, camera);

      acc += dt; frames++;
      if (acc >= 0.5){ fpsEl.textContent = `FPS: ${Math.round(frames/acc)}`; acc = 0; frames = 0; }
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    // Resize
    addEventListener('resize', ()=>{
      camera.aspect = innerWidth/innerHeight; camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });

    // Click to interact on mobile too
    window.addEventListener('click', (e)=>{
      // avoid clicking through panels
      const blockers = [productPanel, cartPanel, startOverlay];
      if (blockers.some(el => el.classList.contains('show'))) return;
      tryInteract();
    });
  </script></body>
</html>