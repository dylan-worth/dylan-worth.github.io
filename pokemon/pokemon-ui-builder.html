<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pok√©Quest | Universal Interface Builder</title>
    <style>
        :root { --indigo: #3c40c6; --accent: #00d2ff; --dark: #0f0f1a; --glass: rgba(255, 255, 255, 0.08); }
        body { background: var(--dark); color: #fff; margin: 0; display: flex; height: 100vh; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* Sidebar & Layout */
        #sidebar { width: 320px; background: #1e1e2e; border-right: 1px solid var(--glass); display: flex; flex-direction: column; padding: 20px; overflow-y: auto; z-index: 100; transition: 0.3s; }
        #workspace { flex: 1; display: flex; justify-content: center; align-items: center; background: radial-gradient(#222 1px, transparent 1px); background-size: 20px 20px; position: relative; }
        
        /* The Canvas (GBC Dimensions) */
        #canvas { width: 270px; height: 220px; background: #333; border: 10px solid #111; border-radius: 4px; position: relative; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.5); }

        /* Dynamic Elements */
        .custom-node { position: absolute; cursor: move; touch-action: none; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .selected { outline: 2px solid var(--accent); box-shadow: 0 0 10px var(--accent); z-index: 999 !important; }

        /* Controls */
        .tool-box { margin-bottom: 20px; background: var(--glass); padding: 12px; border-radius: 8px; }
        h4 { font-size: 10px; text-transform: uppercase; color: var(--accent); margin: 0 0 10px 0; }
        input, select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 8px; margin-bottom: 10px; border-radius: 4px; font-size: 12px; }
        button { width: 100%; padding: 10px; margin-bottom: 5px; border-radius: 6px; border: none; cursor: pointer; background: #444; color: white; font-weight: bold; }
        button.primary { background: var(--indigo); }
        
        #mobile-toggle { position: fixed; top: 15px; right: 15px; background: var(--indigo); border: none; color: white; padding: 10px; border-radius: 5px; z-index: 200; display: none; }
        @media (max-width: 768px) { #sidebar { position: absolute; left: -320px; } #sidebar.open { left: 0; } #mobile-toggle { display: block; } }
    </style>
</head>
<body>

<button id="mobile-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">MENU</button>

<div id="sidebar">
    <h2>CREATION <span style="color:var(--accent)">ENGINE</span></h2>
    
    <div class="tool-box">
        <h4>1. Spawn New Node</h4>
        <button onclick="spawnNode('Box')">Create Container</button>
        <button onclick="spawnNode('Text')">Create Text/Button</button>
        <button onclick="spawnNode('Sprite')">Add Image/Sprite</button>
    </div>

    <div id="editor" style="display: none;">
        <h4>2. Live Editor</h4>
        <label>Content / URL</label>
        <input type="text" id="edit-content" oninput="apply('innerText', this.value); apply('src', this.value)">
        
        <div style="display: flex; gap: 5px;">
            <div><label>W</label><input type="number" id="edit-w" oninput="apply('width', this.value + 'px')"></div>
            <div><label>H</label><input type="number" id="edit-h" oninput="apply('height', this.value + 'px')"></div>
        </div>

        <label>Background Color</label>
        <input type="color" id="edit-bg" oninput="apply('background', this.value)">
        
        <label>Border (px)</label>
        <input type="number" id="edit-border" oninput="apply('border', this.value + 'px solid black')">

        <button onclick="deleteNode()" style="background: #c0392b;">Delete Element</button>
    </div>

    <div class="tool-box">
        <h4>3. Project</h4>
        <button class="primary" onclick="exportCode()">Generate Code</button>
        <textarea id="output" style="width:100%; height:60px; font-size:10px; background:#000; color:#0f0; margin-top:10px;"></textarea>
    </div>
</div>

<div id="workspace">
    <div id="canvas"></div>
</div>

<script>
    let active = null;

    function spawnNode(type) {
        const el = document.createElement(type === 'Sprite' ? 'img' : 'div');
        el.className = 'custom-node';
        el.style.left = '20px'; el.style.top = '20px';
        el.style.width = type === 'Text' ? 'auto' : '100px';
        el.style.height = type === 'Text' ? 'auto' : '40px';
        el.style.background = type === 'Sprite' ? 'transparent' : '#ffffff';
        el.innerText = type === 'Text' ? 'New Button' : '';
        if(type === 'Sprite') el.src = './sprites/ignisaur.png'; // Default placeholder

        el.onpointerdown = (e) => {
            active = el;
            document.querySelectorAll('.custom-node').forEach(n => n.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('editor').style.display = 'block';
            
            // Sync editor inputs
            document.getElementById('edit-content').value = el.innerText || el.src;
            document.getElementById('edit-w').value = parseInt(el.style.width);
            document.getElementById('edit-h').value = parseInt(el.style.height);

            el.setPointerCapture(e.pointerId);
            const rect = el.getBoundingClientRect();
            const startX = e.clientX - rect.left;
            const startY = e.clientY - rect.top;

            el.onpointermove = (ev) => {
                const canvas = document.getElementById('canvas').getBoundingClientRect();
                el.style.left = Math.round((ev.clientX - canvas.left - startX) / 5) * 5 + 'px';
                el.style.top = Math.round((ev.clientY - canvas.top - startY) / 5) * 5 + 'px';
            };
            el.onpointerup = () => { el.onpointermove = null; el.releasePointerCapture(e.pointerId); };
        };

        document.getElementById('canvas').appendChild(el);
    }

    function apply(prop, val) {
        if (!active) return;
        if (prop === 'innerText' && active.tagName !== 'IMG') active.innerText = val;
        else if (prop === 'src' && active.tagName === 'IMG') active.src = val;
        else active.style[prop] = val;
    }

    function deleteNode() { if(active) { active.remove(); active = null; document.getElementById('editor').style.display = 'none'; } }

    function exportCode() {
        let html = "";
        let css = "";
        document.querySelectorAll('.custom-node').forEach((el, i) => {
            const id = `ui-el-${i}`;
            html += `<div id="${id}">${el.innerText}</div>\n`;
            css += `#${id} { \n  position: absolute;\n  left: ${el.style.left};\n  top: ${el.style.top};\n  width: ${el.style.width};\n  height: ${el.style.height};\n  background: ${el.style.background};\n}\n\n`;
        });
        document.getElementById('output').value = css + html;
    }
</script>

</body>
</html>
