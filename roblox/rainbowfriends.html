<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rainbow Friends</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <h1>BLOX</h1>
        <div class="nav-links"><a href="roblox.html">Exit</a></div>
    </nav>
    <div class="container">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Rainbow Friends</h2>
            <h3 id="status" style="color:orange;">Boxes: 0/5</h3>
        </div>
        
        <canvas id="gameCanvas" width="800" height="500"></canvas>

        <div id="mobile-controls">
            <div></div>
            <div class="d-btn" ontouchstart="press('w')" ontouchend="release('w')">▲</div>
            <div></div>
            <div class="d-btn" ontouchstart="press('a')" ontouchend="release('a')">◀</div>
            <div class="d-btn" ontouchstart="press('s')" ontouchend="release('s')">▼</div>
            <div class="d-btn" ontouchstart="press('d')" ontouchend="release('d')">▶</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        function resize() {
            if(window.innerWidth < 800) {
                canvas.style.width = '100%';
                canvas.style.height = (window.innerWidth * 0.625) + 'px';
            }
        }
        window.addEventListener('resize', resize);
        resize();

        let player = { x: 50, y: 50, size: 20, color: "lime" };
        let blue = { x: 700, y: 400, size: 40, color: "blue", speed: 1.5 };
        let boxes = [{x: 200, y:100}, {x:600, y:100}, {x:400, y:250}, {x:100, y:400}, {x:700, y:50}];
        let collected = 0;
        let keys = {};
        let gameOver = false;

        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);

        // Mobile Hooks
        window.press = (k) => keys[k] = true;
        window.release = (k) => keys[k] = false;

        function update() {
            if(gameOver) return;

            // Player Move
            if(keys['w']) player.y -= 3;
            if(keys['s']) player.y += 3;
            if(keys['a']) player.x -= 3;
            if(keys['d']) player.x += 3;

            // Boundaries
            if(player.x < 0) player.x = 0;
            if(player.x > 780) player.x = 780;
            if(player.y < 0) player.y = 0;
            if(player.y > 480) player.y = 480;

            // Blue AI
            let dx = player.x - blue.x;
            let dy = player.y - blue.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            
            if(dist > 0) {
                blue.x += (dx/dist) * blue.speed;
                blue.y += (dy/dist) * blue.speed;
            }

            if(dist < 30) {
                gameOver = true;
                alert("JUMPSCARE! Blue caught you.");
                location.reload();
            }

            // Box Collision
            for(let i=0; i<boxes.length; i++) {
                let b = boxes[i];
                let bdx = player.x - b.x;
                let bdy = player.y - b.y;
                if(Math.sqrt(bdx*bdx + bdy*bdy) < 30) {
                    boxes.splice(i, 1);
                    collected++;
                    document.getElementById('status').innerText = `Boxes: ${collected}/5`;
                    if(collected === 5) {
                        alert("You survived!");
                        location.href = "roblox.html";
                    }
                }
            }
        }

        function draw() {
            ctx.clearRect(0,0,800,500);
            
            // Blue
            ctx.fillStyle = blue.color;
            ctx.fillRect(blue.x - 20, blue.y - 40, 40, 80);
            ctx.fillStyle = "white";
            ctx.beginPath(); ctx.arc(blue.x - 10, blue.y - 30, 5, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(blue.x + 10, blue.y - 30, 5, 0, Math.PI*2); ctx.fill();
            
            // Boxes
            ctx.fillStyle = "orange";
            boxes.forEach(b => ctx.fillRect(b.x, b.y, 20, 20));

            // Player
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, 20, 20);
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }
        loop();
    </script>
</body>
</html>
