<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dragon Wilds Recreated</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Cinzel', serif; }
        canvas { display: block; }

        /* UI Overlay for "Region Discovered" */
        #ui-layer {
            position: absolute;
            top: 20%;
            width: 100%;
            text-align: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 1s ease-in;
        }
        
        #region-box {
            display: inline-block;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px 40px;
            border-top: 2px solid #d4af37; /* Gold border */
            border-bottom: 2px solid #d4af37;
            color: white;
            transform: scale(0.8);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 2px; text-transform: uppercase; color: #ddd; }
        h2 { margin: 5px 0 0 0; font-size: 3rem; color: #d4af37; text-shadow: 0 0 10px #d4af37; }
        
        .visible { opacity: 1 !important; }
        .pop-in { transform: scale(1) !important; }

        /* Controls hint */
        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            font-family: sans-serif;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<div id="ui-layer">
    <div id="region-box">
        <h1>Region Discovered</h1>
        <h2>TEMPLE WOODS</h2>
    </div>
</div>

<div id="controls">WASD / Arrows to Move</div>

<script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
</script>

<script type="module">
    import * as THREE from 'three';

    // --- 1. SETUP ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB); // Sky blue
    scene.fog = new THREE.Fog(0x87CEEB, 10, 50);  // Distance fog for depth

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // --- 2. LIGHTING ---
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);

    const dirLight = new THREE.DirectionalLight(0xffdfba, 1.5); // Warm sunlight
    dirLight.position.set(10, 20, 10);
    dirLight.castShadow = true;
    dirLight.shadow.camera.bottom = -20; // Increase shadow area
    dirLight.shadow.camera.top = 20;
    dirLight.shadow.camera.left = -20;
    dirLight.shadow.camera.right = 20;
    scene.add(dirLight);

    // --- 3. ENVIRONMENT ---
    // Ground (The Woods)
    const planeGeo = new THREE.PlaneGeometry(200, 200);
    const planeMat = new THREE.MeshStandardMaterial({ color: 0x55aa55 });
    const ground = new THREE.Mesh(planeGeo, planeMat);
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    // The "Castle" Archway (represented by simple blocks)
    const wallMat = new THREE.MeshStandardMaterial({ color: 0x444444 });
    const wallGeo = new THREE.BoxGeometry(4, 6, 1);
    
    const leftWall = new THREE.Mesh(wallGeo, wallMat);
    leftWall.position.set(-3, 3, 0);
    leftWall.castShadow = true;
    scene.add(leftWall);

    const rightWall = new THREE.Mesh(wallGeo, wallMat);
    rightWall.position.set(3, 3, 0);
    rightWall.castShadow = true;
    scene.add(rightWall);

    const topWall = new THREE.Mesh(new THREE.BoxGeometry(10, 2, 1), wallMat);
    topWall.position.set(0, 7, 0);
    topWall.castShadow = true;
    scene.add(topWall);

    // Roof/Tunnel to make it dark inside
    const tunnelGeo = new THREE.BoxGeometry(10, 8, 10);
    const tunnel = new THREE.Mesh(tunnelGeo, new THREE.MeshStandardMaterial({ color: 0x333333, side: THREE.DoubleSide }));
    tunnel.position.set(0, 4, -5.5);
    tunnel.receiveShadow = true;
    scene.add(tunnel);

    // Trees (Simple Cones)
    function addTree(x, z) {
        const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.4, 2), new THREE.MeshStandardMaterial({color: 0x8B4513}));
        trunk.position.set(x, 1, z);
        trunk.castShadow = true;
        
        const leaves = new THREE.Mesh(new THREE.ConeGeometry(2, 6, 8), new THREE.MeshStandardMaterial({color: 0x228b22}));
        leaves.position.set(x, 4, z);
        leaves.castShadow = true;
        
        scene.add(trunk);
        scene.add(leaves);
    }
    // Add some random trees outside
    for(let i=0; i<20; i++) {
        addTree(-20 + Math.random()*40, 10 + Math.random()*40);
    }

    // --- 4. PLAYER ---
    const playerGeo = new THREE.CapsuleGeometry(0.5, 1, 4, 8);
    const playerMat = new THREE.MeshStandardMaterial({ color: 0xffaa00 }); // Gold shirt like video
    const player = new THREE.Mesh(playerGeo, playerMat);
    player.position.set(0, 1, -8); // Start inside the tunnel
    player.castShadow = true;
    scene.add(player);

    // --- 5. DRAGON (Simplified) ---
    const dragonGroup = new THREE.Group();
    // Body
    const dBody = new THREE.Mesh(new THREE.ConeGeometry(0.5, 3, 4), new THREE.MeshStandardMaterial({color: 0xff0000}));
    dBody.rotation.x = Math.PI / 2;
    // Wings
    const dWing = new THREE.Mesh(new THREE.BoxGeometry(4, 0.1, 1), new THREE.MeshStandardMaterial({color: 0xaa0000}));
    dragonGroup.add(dBody, dWing);
    dragonGroup.position.set(0, 15, 20); // High up in the sky
    scene.add(dragonGroup);

    // --- 6. LOGIC & CONTROLS ---
    const keys = { w: false, a: false, s: false, d: false };
    window.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true); // Using 'we' implies group effort!
    window.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);

    let regionDiscovered = false;
    const playerSpeed = 0.1;
    const cameraOffset = new THREE.Vector3(0, 3, -5); // Behind the player

    function animate() {
        requestAnimationFrame(animate);

        // Player Movement
        if (keys['w'] || keys['arrowup']) player.position.z += playerSpeed;
        if (keys['s'] || keys['arrowdown']) player.position.z -= playerSpeed;
        if (keys['a'] || keys['arrowleft']) player.position.x += playerSpeed;
        if (keys['d'] || keys['arrowright']) player.position.x -= playerSpeed;

        // Camera Follow
        const targetPos = player.position.clone();
        targetPos.add(new THREE.Vector3(0, 5, -8)); // Offset camera
        camera.position.lerp(targetPos, 0.1); // Smooth follow
        camera.lookAt(player.position);

        // Dragon Animation (Circle around)
        const time = Date.now() * 0.001;
        dragonGroup.position.x = Math.sin(time) * 20;
        dragonGroup.position.z = 20 + Math.cos(time) * 10;
        dragonGroup.rotation.y = -time; // Spin

        // Trigger Event: Exiting the Castle (Z > 0)
        if (player.position.z > 2 && !regionDiscovered) {
            regionDiscovered = true;
            triggerUI();
        }

        renderer.render(scene, camera);
    }

    function triggerUI() {
        const ui = document.getElementById('ui-layer');
        const box = document.getElementById('region-box');
        
        ui.classList.add('visible');
        setTimeout(() => {
            box.classList.add('pop-in');
        }, 100);

        // Hide after a few seconds
        setTimeout(() => {
            ui.classList.remove('visible');
            box.classList.remove('pop-in');
        }, 4000);
    }

    // Handle Resize
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
</script>
</body>
</html>
